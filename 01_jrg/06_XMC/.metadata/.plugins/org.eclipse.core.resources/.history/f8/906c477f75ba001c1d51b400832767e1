/*
 * Analog.c
 *
 *  Created on: 12 Apr 2022
 *      Author: Yoshi
 */

#include "Analog.h"
#include "Header.h"

void ANA_Init()
{
	temp_sensor_1.Channel = &ADC_MEASUREMENT_Channel_A;
	temp_sensor_1.index = 0;
	temp_sensor_1.buffer = 0;

	voltage_cell_1.Channel = &ADC_MEASUREMENT_Channel_B;
}

void ANA_Read(analog_sensor_t *const Sensor)
{
	Sensor->value = ADC_MEASUREMENT_GetResult(Sensor->Channel);
	Sensor->buffer[index] = Sensor->value;

	//Implementation of a circular Buffer
	if(Sensor->index < 4)
	{
		Sensor->index++;
	}
	else
	{
		Sensor->index = 0;
	}

	int i;
	for(i=0; i<5; i++)
	{
		Sensor->out_buffer += ((Sensor->buffer[i]*Sensor->IIR_coeff[i])>>12);

	}
}

void Task_ANA_Read()
{
	while(1)
	{
		ADC_MEASUREMENT_StartConversion(&ADC_MEASUREMENT_0);
		ANA_Read(&temp_sensor_1);

		ANA_Read(&voltage_cell_1);

		vTaskDelay(pdMS_TO_TICKS(0.1));
	}
}

void IIR_Filter(analog_sensor_t *const Sensor)
{
	int i;
	for(i=0; i<5; i++)
	{

	}
}

void circindex(uint16_t index, uint16_t step, uint16_t length)
{
	index++;
	if(index = length)
	{
		index = 0;
	}
}



